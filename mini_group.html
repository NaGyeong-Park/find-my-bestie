<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <title>Group</title>
  <style>
    @font-face {
    font-family: 'IM_Hyemin-Bold';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2106@1.1/IM_Hyemin-Bold.woff2') format('woff');
    font-weight: normal;
    font-style: normal;
}
    body {
      background-color:rgb(0, 29, 0);
      color: white;
    }
    
    .isValid {
      color: rgb(104, 104, 104);
      text-decoration-line: line-through;
    }
    div {
      font-family: 'IM_Hyemin-Bold';
    }
    #studentListItem {
      text-align: center;
      margin : 1rem;
      cursor: pointer; 
    }
    #studentListItem:hover {
      color: gray
    }
    .container {
      text-align: center;
    }
    #pick:hover{
       cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <!--Header-->
    <div class="m-5">
      <h1 class="text-warning">귀염둥이 4반 모여라</h1>
    </div>

    <!--발표자 뽑기-->
    <div class="row justify-content-between">
      <div class="">
        <h4 style="color: rgb(255, 80, 109)">결석 : {{absent}}</h4>
      </div>
      <div class="" id="pick">
        <i :class="beforeIcon" @click="randomPick" @mouseover="mouseOver" @mouseleave="mouseLeave"></i>
      </div>
    </div>

    <!--loading-->
    <div v-if="loading">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>조를 바꾸고 있어요...</p>
    </div>
    <div v-if="finished">
      <div>
        바뀐 조 친구들과 인사하세요!
      </div>
    </div>

    <!--교탁-->
    <div class="p-5 border border-light rounded-3">
      <h3 v-if="!choseMember">aiden 자리</h3>
      <h3 v-if="choseMember">{{choseGroup+1}}조의 {{choseMember}} 앞으로 나와!</h3>
    </div>
    <!--Group Card-->
    <transition v-if="dugudugu"
      name="custom-classes-transition"
      enter-active-class="animated tada"></transition>
    <div class="row">
      <div class="col my-4" v-for="(group,idx) in myGroups">
        <div class="card border border-light rounded-3" style="width: 15rem; background-color: rgb(0, 29, 0);">
          <div class="card-body ">
            <h5 class="card-title text-info">{{idx+1}}조</h5>
            <p class="card-text" v-for="student in group">{{student}}</p>
          </div>
        </div>
      </div>
    </div>
  </transition>

    <div>
      그룹 사람 수 : <input id="submit" placeholder="몇명씩?" type="text" v-model="number" @keydown.enter="groupStudents(number)">
      <button @click="groupStudents(number)">명씩!</button>
    </div>





    <h3 style="margin-top: 30px;">Student List</h3>
    <p>클릭하면 결석처리 됩니다!</p>
    <input type="text" placeholder="오늘 안온사람?" v-model="student" @keydown.enter="toggleStudent(student)">
    <div class="row">
      <div class="col-3" v-for="student in students">
        <div id="studentListItem"
        :class="{ isValid : !student.isValid }"
        @click="toggleStudent(student.name)">{{student.name}}
        </div>
      </div>
    </div>


  </div>
  <script src="https://kit.fontawesome.com/25a5039376.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
    const app = new Vue({
      el: '#app',
      data: {
        students: [{name: '강승리', isValid: true},
        {name: '권수린', isValid: true},
        {name: '김정현', isValid: true},
        {name: '김진환', isValid: true},
        {name: '김태경', isValid: true},
        {name: '김현열', isValid: true},
        {name: '류경하', isValid: true},
        {name: '문숙경', isValid: true},
        {name: '박나경', isValid: true},
        {name: '성지훈', isValid: true},
        {name: '오종혁', isValid: true},
        {name: '이규민', isValid: true},
        {name: '이동희', isValid: true},
        {name: '이상택', isValid: true},
        {name: '이성진', isValid: true},
        {name: '이종현', isValid: true},
        {name: '이현진', isValid: true},
        {name: '임수환', isValid: true},
        {name: '전윤선', isValid: true},
        {name: '정승윤', isValid: true},
        {name: '정유송', isValid: true},
        {name: '정형진', isValid: true},
        {name: '채민진', isValid: true},
        {name: '한지희', isValid: true},],
        student : '',
        vStudent: '',
        number: '',
        myGroups: [],
        choseGroup: '',
        choseMember: '',
        loading: false,
        finished: false,
        absent: [],
        dugudugu: true,
        beforeIcon: 'fa-2x fa-solid fa-face-smile flex-row-reverse',
      },
      methods: {
        // 안 온 학생 비활성화(그룹에 포함X)
        toggleStudent(student){
          if (confirm('그룹이 초기화 됩니다, 계속 하시겠습니까?')){
            this.students[this.students.findIndex(obj =>obj.name === student)].isValid= !this.students[this.students.findIndex(obj => obj.name === student)].isValid
            this.resetLocal()
            this.soloGroup()
            if (this.absent === null || this.absent.indexOf(student) === -1){
              this.absent.push(student)
            }
            else {
              let indexAbsent = this.absent.indexOf(student)
              this.absent.splice(indexAbsent, 1)
            }
          }
        },
        // 그룹 만들기
        groupStudents(number){
          // loading div와 finished div 나왔다가 숨기기
          this.loading = !this.loading

          var that = this;
          setTimeout(function() {
              that.loading = !that.loading;
              that.finished = !that.finished;
            }, 3000);

          var like = this;
          setTimeout(function() {
              like.finished = !like.finished;
            }, 6000);

          // isValid가 true인 학생들만 그룹지어 만들어준다.
          const vaildStudent = this.students.filter(student => {
            return student.isValid
          }).map(student => student.name)
          const group = _.chunk(vaildStudent, number)
          for (let i = 1; i <= 10; i++) {
            setTimeout((i) => {
              this.myGroups = _.shuffle(group)
              // LocalStorage에 생성한 Group을 저장해준다.
              const jsonData = JSON.stringify(this.myGroups)
              window.localStorage.setItem('myGroups', jsonData)
            }, i * 250);
          }
          this.choseMember = !this.choseMember
        },
        // 그룹 초기화
        soloGroup(){
          const vaildStudent = this.students.filter(student => {
            return student.isValid
          }).map(student => student.name)
          const group = _.chunk(vaildStudent, 1)
          this.myGroups = group
        },
        resetLocal(){
          window.localStorage.clear()
        },
        randomGroup(){
          this.dugudugu = !this.dugudugu
          this.choseGroup = _.random(1,this.myGroups.length)
          // 인덱스는 0부터 시작하므로 편의를 위해 1 빼주기
          this.choseGroup -= 1
          this.randomGroupMember()
        },
        randomGroupMember(){
          // 진짜 어이없는 일
          // GroupStudent라고 했다가 이름이 구렸는지
          // AI가 Member이라고 바꿨다...ㅋㅋ
          // 그룹 없이 뽑는 경우 / 1명씩 그룹에서 뽑는 경우 / 1그룹만 만들고 뽑는 경우
          if ( !this.myGroups || this.myGroups[0].length === 1 || this.myGroups.length === 1 ){
            this.choseMember = _.random(1,this.students.length)
            this.choseMember = this.students[this.choseMember-1].name;
          }
          else {
            this.choseMember = _.random(this.myGroups[this.choseGroup].length-1)
            this.choseMember = this.myGroups[this.choseGroup][this.choseMember]
          }
        },
        randomPick(){
          for (let i = 1; i <= 10; i++) {
            setTimeout((i) => {
              this.randomGroup()
            }, i * 250);
          }
        },
        mouseOver(){
          this.beforeIcon = 'fa-solid fa-face-kiss-wink-heart flex-row-reverse fa-2x '
        },
        mouseLeave(){
          this.beforeIcon = 'fa-solid fa-face-smile flex-row-reverse fa-2x '
        },
        // startBlink(){
        //   console.log('hi');
        //   setInterval(this.doBlink,350)
        //   clearInterval(this.doBlink)
        // },
      //   doBlink(){
      //     var blink = document.getElementById('blink')
      //     for (var i = 0; i < blink.length; i++) {
      //       blink[i].style.color = "blue" 
      //     }
      //   },
      },
      created() {
        // LocalStorage의 MyGroup을 가져와준다.
        const groups = window.localStorage.getItem('myGroups')
        this.myGroups = JSON.parse(groups)
        if (!this.myGroups){
          this.soloGroup()
        }
        }        
    })
  </script>
</body>

</html>