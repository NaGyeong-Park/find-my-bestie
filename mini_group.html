<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <title>Group</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
  <style>
    .isValid {
      color: rgb(104, 104, 104);
      text-decoration-line: line-through;
    }
    div {
      font-family: 'Jua', sans-serif;
    }
    #studentListItem {
      text-align: center;
      margin : 1rem;
      cursor: pointer; 
    }
    #studentListItem:hover {
      color: gray
    }
    .container {
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1 style="margin:30px; color: skyblue;">My Group</h1>
    <div class="d-flex">
      <div class="col"  v-for="(group,idx) in myGroups">
        <p>{{idx+1}}조</p>
        <div class="col" v-for="student in group">{{student}}</div>
      </div>
    </div>
    
    <div class="accordion" id="accordionExample">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            그룹을 바꿔볼까?
          </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            그룹 사람 수 : <input id="submit" placeholder="몇명씩?" type="text" v-model="number" @keydown.enter="groupStudents(number)">
            <button @click="groupStudents(number)">명씩!</button>
            <button @click="resetGroup">초기화할래</button>
            <p>결석 : {{absentStudents}}</p>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingThree">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            발표자를 뽑아볼까?
          </button>
        </h2>
        <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
          <div class="accordion-body">
            <button @click="randomGroup">몇조고</button>
            <p>{{choseGroup+1}}조 입니다!</p>
            <button @click="randomGroupMember(choseGroup)">누구고</button>
            <p>{{choseGroup+1}}조의 {{choseMember}} 입니다!</p>          </div>
        </div>
      </div>
    </div>



    <h3 style="margin-top: 30px;">Student List</h3>
    <p>클릭하면 결석처리 됩니다!</p>
    <input type="text" placeholder="오늘 안온사람?" v-model="student" @keydown.enter="toggleStudent(student)">
    <div class="row">
      <div class="col-3" v-for="student in students">
        <div style="" id="studentListItem"
        :class="{ isValid : !student.isValid }"
        @click="toggleStudent(student.name)">{{student.name}}
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
    const app = new Vue({
      el: '#app',
      data: {
        students: [{name: '강승리', isValid: true},
        {name: '권수린', isValid: true},
        {name: '김정현', isValid: true},
        {name: '김진환', isValid: true},
        {name: '김태경', isValid: true},
        {name: '김현열', isValid: true},
        {name: '류경하', isValid: true},
        {name: '문숙경', isValid: true},
        {name: '박나경', isValid: true},
        {name: '성지훈', isValid: true},
        {name: '오종혁', isValid: true},
        {name: '이규민', isValid: true},
        {name: '이동희', isValid: true},
        {name: '이상택', isValid: true},
        {name: '이성진', isValid: true},
        {name: '이종현', isValid: true},
        {name: '이현진', isValid: true},
        {name: '임수환', isValid: true},
        {name: '전윤선', isValid: true},
        {name: '정승윤', isValid: true},
        {name: '정유송', isValid: true},
        {name: '정형진', isValid: true},
        {name: '채민진', isValid: true},
        {name: '한지희', isValid: true},],
        student : '',
        vStudent: '',
        number: '',
        myGroups: [],
        choseGroup: '',
        choseMember: '',
        absentStudents: '',
      },
      methods: {
        // 안 온 학생 비활성화(그룹에 포함X)
        toggleStudent(student){
          if (confirm('그룹이 초기화 됩니다, 계속 하시겠습니까?')){
            this.students[this.students.findIndex(obj =>obj.name === student)].isValid= !this.students[this.students.findIndex(obj => obj.name === student)].isValid
            this.resetGroup()
            this.nowAbsentStudents()
            window.localStorage.setItem('students', jsonData)
          }
        },
        // 그룹 만들기
        groupStudents(number){
          // isValid가 true인 학생들만 그룹지어 만들어준다.
          const vaildStudent = this.students.filter(student => {
            return student.isValid
          }).map(student => student.name)
          const group = _.chunk(vaildStudent, number)
          this.myGroups = group
          
          // LocalStorage에 생성한 Group을 저장해준다.
          const jsonData = JSON.stringify(this.myGroups)
          window.localStorage.setItem('myGroups', jsonData)
          return this.myGroups
        },
        // 그룹 초기화
        resetGroup(){
          window.localStorage.clear()
          this.myGroups = this.groupStudents(1)
        },
        randomGroup(){
          this.choseGroup = _.random(1,this.myGroups.length)
          // 인덱스는 0부터 시작하므로 편의를 위해 1 빼주기
          this.choseGroup -= 1
        },
        randomGroupMember(){
          // 진짜 어이없는 일
          // GroupStudent라고 했다가 이름이 구렸는지
          // AI가 Member이라고 바꿨다...ㅋㅋ
          // 그룹 없이 뽑는 경우 / 1명씩 그룹에서 뽑는 경우 / 1그룹만 만들고 뽑는 경우
          if ( !this.myGroups || this.myGroups[0].length === 1 || this.myGroups.length === 1 ){
            this.choseMember = _.random(1,this.students.length)
            this.choseMember = this.students[this.choseMember-1].name;
          }
          // 그룹이 1개 초과 or 그룹안에 사람이 1명 초과로 있는데도 불구하고 조를 안뽑았을 경우
          else if ( this.choseGroup === -1 || this.choseGroup === '' ) {
            this.choseMember = '조를 안뽑았자넝~'
          }
          else {
            this.choseMember = _.random(this.myGroups[this.choseGroup].length-1)
            this.choseMember = this.myGroups[this.choseGroup][this.choseMember]
          }
        },
        nowAbsentStudents(){
          const absentStudents = this.students.filter(student => {
              return !student.isValid
            }).map(student => student.name)
            window.localStorage.setItem('myGroups', jsonData)
            window.localStorage.setItem('adsentStudents', jsonData)
            return this.absentStudents = absentStudents
        }
      },
      created() {
        // LocalStorage의 MyGroup을 가져와준다.
        const groups = window.localStorage.getItem('myGroups')
        const absent = window.localStorage.getItem('adsentStudents')
        this.myGroups = JSON.parse(groups)
        this.absentStudents = JSON.parse(absent)
      }
    })
  </script>
</body>

</html>